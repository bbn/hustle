var Category=Backbone.Model.extend({events:function(){var b=this.id;var a=festival.events.filter(function(c){return(c.get("category")==b)});return new EventCollection(a)}});var CategoryFooterListView=Backbone.View.extend({tagName:"li",template:_.template("<a href='#category/<%= id %>'><span class='cat'></span><%= name %></a>"),render:function(){$(this.el).html(this.template(this.model.toJSON()));this.$(".cat").addClass(this.model.get("name"));return this}});var Artist=Backbone.Model.extend({events:function(){var b=this.id;var a=festival.events.filter(function(c){return(c.artists().map(function(d){return d.id}).indexOf(b)!=-1)});return new EventCollection(a)}});var ArtistView=Backbone.View.extend({el:"#artist-wrapper",template:_.template('<div class="copy-block"><label>WHO</label><div id="blurb"><%= blurb %></div><div id="url"><a href="<%= url %>" class="url"><%= url %></a></div><label>WHEN</label></div><ul id="artist-events" class="listview"></ul>'),initialize:function(){_.bindAll(this,"render")},render:function(){$(this.el).html(this.template(this.model.toJSON()));var b=this.model.toJSON();$(".sub-title").html(b.name);var a=null;if(b.image===""||b.image===null){a="img/artists/noimage.png"}else{a=b.image}$(".artist-img").html('<img src="'+a+'" class="artist-img-src">');var d=this.model.events();for(var c=0;c<d.length;c++){var e=new EventListView({model:d.at(c)});this.$("#artist-events").append(e.render().el)}return this}});var ArtistListView=Backbone.View.extend({tagName:"li",template:_.template("<a href='#artist/<%= id %>'><%= name %></a>"),initialize:function(){_.bindAll(this,"render")},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var Event=Backbone.Model.extend({initialize:function(){_.bindAll(this,"dereference","name","description","category","artists","venue")},dereference:function(c,a){var b=this.get(c);return a.filter(function(d){if(typeof(b)=="object"){return(b.indexOf(d.id)!=-1)}else{return(d.id==b)}})},name:function(){if(this.get("name")){return this.get("name")}else{return this.artists().map(function(b){return b.get("name")}).join(", ")}},description:function(){if(this.get("description")){return this.get("description")}else{var a=this.artists();if(a.length==1){return a.at(0).get("blurb")}}},image:function(){if(this.get("image")){return this.get("image")}else{var a=this.artists();if(a.length==1){return a.at(0).get("image")}}},category:function(){return this.dereference("category",festival.categories)[0]},artists:function(){return new ArtistCollection(this.dereference("artist",festival.artists))},venue:function(){return this.dereference("venue",festival.venues)[0]}});var EventView=Backbone.View.extend({el:"#event-wrapper",template:_.template('<div class="copy-block"><label>WHEN</label><div id="date"><%= dateString %></div><label>WHERE</label><ul id="venuename"></ul><label>WHAT</label><div id="description"><%= description %></div></div><ul class="listview" id="event-artists"></ul>'),initialize:function(){_.bindAll(this,"render");$(this.el).addClass("event-content")},render:function(){var d=this.model.toJSON();_.extend(d,{name:this.model.name(),description:(this.model.description()||""),dateString:dateFormat(this.model.get("date"),"dddd, mmmm dS, yyyy, h:MM:ss TT")});$(this.el).html(this.template(d));$(".sub-title").html(this.model.name());this.$("ul#venuename").html((new VenueListView({model:this.model.venue()})).render().el);var a=this.model.artists();for(var b=0;b<a.length;b++){var c=new ArtistListView({model:a.at(b)});this.$("#event-artists").append(c.render().el)}return this}});var EventListView=Backbone.View.extend({tagName:"li",template:_.template("<a href='#event/<%= id %>'><span class='cat'></span><div class='details'><span class='name'><%= eventName %></span><span class='venue'><%= venuename %></span><span class='time'><%= timeString %></span></div></a>"),initialize:function(a){if(a.dateFormatString){this.dateFormatString=a.dateFormatString}},dateFormatString:"dddd, mmmm dS h:MM TT",render:function(){var a=this.model.toJSON();var c=this.model;_.extend(a,{eventName:c.name(),timeString:dateFormat(this.model.get("date"),this.dateFormatString),venuename:this.model.venue().get("name")});$(this.el).html(this.template(a));var b=this.model.category();$(this.el).addClass(b.attributes.name);this.$("cat").addClass(b.attributes.name);return this}});var EventsByDayListView=Backbone.View.extend({tagName:"li",initialize:function(a){this.slug=a.slug;this.date=a.date},template:_.template("<a href='#events/<%= slug %>'><%= dateString %></a>"),render:function(){var a=dateFormat(this.date,"dddd, mmmm dS");$(this.el).html(this.template({slug:this.slug,dateString:a}));return this}});var EventsByDayView=Backbone.View.extend({el:"#events-by-day-list",initialize:function(a){_.bindAll(this,"render");this.festival=a.festival},render:function(){for(var b in this.festival.eventsByDay){var a=this.festival.eventsByDay[b].at(0).get("date");row=new EventsByDayListView({slug:b,date:a});$(this.el).append(row.render().el)}return this}});var EventsView=Backbone.View.extend({el:"#events-page",initialize:function(a){_.bindAll(this,"render");this.title=a.title;this.eventsToList=a.eventsToList;if(a.dateFormatString){this.dateFormatString=a.dateFormatString}},template:_.template('<div class="header"><div class="back-btn"><a class="dir-button back black"><span></span>back</a></div><h1 class="title"><%= title %></h1></div><div class="content scroller" id="events-content"><ul id="event-list" class="listview"></ul></div><div class="footer"><ul id="legend"></ul></div>'),dateFormatString:"dddd, mmmm dS h:MM TT",render:function(){$(this.el).html(this.template({title:this.title}));var b=this.$("#event-list");var c=this.dateFormatString;this.eventsToList.forEach(function(f){var d=new EventListView({model:f,dateFormatString:c});b.append(d.render().el)});var a=this.$("#legend");festival.categories.forEach(function(d){tab=new CategoryFooterListView({model:d});a.append(tab.render().el)});this.$(".back").bind("click",function(d){goBack(d)});return this}});window.Sponsor=Backbone.Model.extend({defaults:{blurb:""}});var SponsorView=Backbone.View.extend({template:_.template('<div class="image loading"><img src="img/sponsors/<%= image %>" width="320" height="125"></div><div class="blurb"><%= blurb %></div><div class="url"><a href="<%= url %>" class="url"><%= url %></a></div>'),events:{},initialize:function(){_.bindAll(this,"render")},render:function(){var b=this.model.toJSON();$(this.el).html(this.template(b));var a=this.model.toJSON();return this}});var SponsorListView=Backbone.View.extend({tagName:"li",template:_.template("<a href='#sponsor/<%= id %>'><%= name %></a>"),render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var Venue=Backbone.Model.extend({initialize:function(){_.bindAll(this,"events")},events:function(){var b=this.get("id");var a=festival.events.filter(function(c){return(c.get("venue")==b)});return new EventCollection(a)}});var VenueView=Backbone.View.extend({template:_.template('<div id="map" class="loading"><img src="http://maps.googleapis.com/maps/api/staticmap?center=<%= address %>&zoom=15&size=320x200&markers=color:red%7C<%=address%>&sensor=false"></div><div class="address"><div class="name"><%= name %></div><%= address %></div><div id="venue-wrapper"><ul id="venue-events" class="listview"></ul></div>'),events:{},initialize:function(a){_.bindAll(this,"render");this.render()},render:function(){$(this.el).html(this.template(this.model.toJSON()));var b=this.model.events();for(var a=0;a<b.length;a++){var c=new EventListView({model:b.at(a)});this.$("#venue-events").append(c.render().el)}return this}});var VenueListView=Backbone.View.extend({tagName:"li",template:_.template("<a href='#venue/<%= id %>'><%= name %></a>"),render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var VenueCollection=Backbone.Collection.extend({model:Venue});var ArtistCollection=Backbone.Collection.extend({model:Artist});var CategoryCollection=Backbone.Collection.extend({model:Category});var EventCollection=Backbone.Collection.extend({model:Event,comparator:function(a){return new Date(a.get("date"))}});var SponsorCollection=Backbone.Collection.extend({model:Sponsor});function slugify(a){a=a.replace(/[^-a-zA-Z0-9,&\s]+/ig,"");a=a.replace(/-/gi,"_");a=a.replace(/\s/gi,"-");return a}var Festival=Backbone.Model.extend({initialize:function(){this.venues=new VenueCollection(this.get("venues"));this.artists=new ArtistCollection(this.get("artists"));this.categories=new CategoryCollection(this.get("categories"));this.events=new EventCollection(this.get("events"));this.sponsors=new SponsorCollection(this.get("sponsors"));this.eventsByDay={};for(i=0;i<this.events.length;i++){var c=this.events.at(i);var f=new Date(c.get("date"));var b=f.toDateString();var a=slugify(b);if(!this.eventsByDay[a]){this.eventsByDay[a]=new EventCollection()}this.eventsByDay[a].add(c)}}});var FestivalView=Backbone.View.extend({el:"#home-page",template:_.template('<div id="buttons"></div>'),events:{},initialize:function(a){_.bindAll(this,"render")},render:function(){this.$("#buttons").html("");var c={schedule:"#events-by-day",artists:"#artists",venues:"#venues",twitter:"#twitter",sponsors:"#sponsors",info:"#info"};for(var b in c){var a=new FestivalViewButton({name:b,selectorLink:c[b]});this.$("#buttons").append(a.render().el)}return this}});var FestivalViewButton=Backbone.View.extend({initialize:function(a){_.bindAll(this,"render");this.name=a.name;this.selectorLink=a.selectorLink},template:_.template('<a href="<%= selectorLink  %>" class="button"><%= name %></a>'),render:function(){$(this.el).html(this.template({selectorLink:this.selectorLink,name:this.name}));return this}});var FestivalRouter=Backbone.Router.extend({initialize:function(a){this.model=a.model;_.bindAll(this,"home","eventsByDay","events","event","category","artists","artist","venues","venue","twitter","sponsors","info")},routes:{"":"home","events-by-day":"eventsByDay","events/:slug":"events","category/:id":"category",artists:"artists","artist/:id":"artist",venues:"venues","venue/:id":"venue",twitter:"twitter",sponsors:"sponsors","sponsor/:id":"sponsor",info:"info","event/:id":"event"},showPage:function(a){$(".active").removeClass("active");$(a).addClass("active");setContentHeight();$(".dir-button.black").css("color","#fff")},home:function(){this.showPage("#home-page")},eventsByDay:function(){this.showPage("#events-by-day-page")},events:function(b){var c=festival.eventsByDay[b];var d=dateFormat((new Date(c.at(0).get("date"))),"dddd mm/dd");var a=new EventsView({title:d,eventsToList:c,dateFormatString:"h:MM TT"});a.render();this.showPage("#events-page");scrollThis("events-content")},event:function(c){var b=null;for(i=0;i<this.model.events.length;i++){if(this.model.events.at(i).id==c){b=this.model.events.at(i);break}}var a=new EventView({model:b});$("#event-content").html(a.render().el);this.showPage("#event-page");scrollThis("event-content")},category:function(c){var a=null;for(i=0;i<this.model.categories.length;i++){if(this.model.categories.at(i).id==c){a=this.model.categories.at(i);break}}var b=new EventsView({title:a.get("name"),eventsToList:a.events()});b.render();this.showPage("#events-page");scrollThis("events-content")},artists:function(){this.showPage("#artists-page");scrollThis("artists-content")},artist:function(c){var b=null;for(i=0;i<this.model.artists.length;i++){if(this.model.artists.at(i).id==c){evnt=this.model.artists.at(i);break}}var a=new ArtistView({model:evnt});$("#artist-content").html(a.render().el);this.showPage("#artist-page");scrollThis("artist-content")},venues:function(){this.showPage("#venues-page");scrollThis("venues-content")},venue:function(c){var a;for(i=0;i<this.model.venues.length;i++){if(this.model.venues.at(i).id==c){a=this.model.venues.at(i);break}}var b=new VenueView({model:a});$("#venue-content").html(b.render().el);this.showPage("#venue-page");scrollThis("venue-content")},twitter:function(){this.showPage("#twitter-page");scrollThis("twitter-content")},sponsors:function(){this.showPage("#sponsors-page");scrollThis("sponsors-content")},sponsor:function(c){var b;for(i=0;i<this.model.sponsors.length;i++){if(this.model.sponsors.at(i).id==c){b=this.model.sponsors.at(i);break}}var a=new SponsorView({model:b});$("#sponsor-content").html(a.render().el);this.showPage("#sponsor-page")},info:function(){this.showPage("#info-page");scrollThis("info-content")}});var TwitterView=Backbone.View.extend({el:"#twitter-wrapper",events:{},initialize:function(a){this.widget=new TWTR.Widget({version:2,id:"twitter-wrapper",type:"search",search:a.search,interval:6000,title:"tweets about",width:320,height:400,theme:{shell:{background:"#ffffff",color:"#ffffff"},tweets:{background:"#ffffff",color:"#555555",links:"#000000"}},features:{scrollbar:false,loop:false,live:false,hashtags:true,timestamp:true,avatars:true,toptweets:true,behavior:"all"}}).render().start()}});var infoView=Backbone.View.extend({el:"#info-wrapper",template:_.template('<p><%= ticketinfo %></p><p><%= about %></p><p><a href="<%= url %>" class="url"><%= url %></a></p><div id="credit"><h3>Who made this app?</h3><br>Your pals at <a id="credit-link" href="http://www.mainsocial.com">mainsocial</a> made this.</div>'),initialize:function(){_.bindAll(this,"render");this.render()},render:function(){$(this.el).html(this.template(this.model));return this}});function onLoad(){document.addEventListener("deviceready",onDeviceReady,false)}function onDeviceReady(){checkConnection();var a=device.platform;$("html").addClass(a)}function checkConnection(){var a=navigator.network.connection.type;var b={};b[Connection.UNKNOWN]="Unknown connection";b[Connection.ETHERNET]="Ethernet connection";b[Connection.WIFI]="WiFi connection";b[Connection.CELL_2G]="Cell 2G connection";b[Connection.CELL_3G]="Cell 3G connection";b[Connection.CELL_4G]="Cell 4G connection";b[Connection.NONE]="No network connection";if(b[a]=="Unknown connection"||b[a]=="No network connection"){alert("No internet connection detected. Check your connection and restart the app.");$("#buttons").html('<div class="nointernet">No internet connection detected. Check your connection and restart the app.</div>')}}function goBack(a){a.preventDefault();$(".dir-button.black").css("color","gold");history.back()}function scrollThis(b){var a=null;a=new iScroll(b,{hScrollbar:false,vScrollbar:false})}function setContentHeight(){var a=window.innerHeight;var d=$(".active .header").height();if(d===null){d=0}else{$(".active .content").css("top",d);$(".active .header").css("height",d)}var c=$(".active .footer").height();if(c===null){c=0}else{$(".active .footer").css("height",c)}var b=a-d-c;$(".active .content").css("height",b)};